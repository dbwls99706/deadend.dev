<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0d1117">
  <title>Error Search — {{ total_errors }} Errors with Verified Fixes | deadends.dev</title>
  <meta name="description" content="Paste your error message to instantly find dead ends to avoid and verified workarounds. Matches against {{ total_errors }} known error patterns across {{ domain_count }} domains.">
  <meta name="robots" content="index, follow, max-snippet:-1">
  <link rel="icon" href="{{ base_path }}/favicon.svg" type="image/svg+xml">
  <meta name="keywords" content="error search, error fix, troubleshooting, dead end, workaround, python error, cuda error, node error, docker error, pip error, git error">
  <link rel="canonical" href="{{ base_url }}/search/">
  <meta property="og:title" content="Error Search — {{ total_errors }} Errors with Verified Fixes">
  <meta property="og:description" content="Paste your error message to instantly find known dead ends and verified workarounds.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ base_url }}/search/">
  <meta property="og:site_name" content="deadends.dev">
  <meta property="og:image" content="{{ base_url }}/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="en_US">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="{{ base_url }}/og-image.png">

  <!-- BreadcrumbList for Google rich results -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "deadends.dev", "item": "{{ base_url }}"},
      {"@type": "ListItem", "position": 2, "name": "Error Search"}
    ]
  }
  </script>

  <link rel="stylesheet" href="{{ base_path }}/style.css">
</head>
<body class="pg-search">
  <a href="#search-input" class="skip-link">Skip to search</a>
  {% autoescape false %}
  <pre id="ai-summary" style="display:none;">PAGE: Error Search
PURPOSE: Match error messages against {{ total_errors }} known patterns across {{ domain_count }} domains
USAGE: Fetch /api/v1/index.json to get all error signatures with regex patterns. Match your error against regexes. Fetch the matching error's api_url for full dead_ends and workarounds.
API_INDEX: {{ base_url }}/api/v1/index.json</pre>
  {% endautoescape %}

  <nav><a href="{{ base_path }}/">deadends.dev</a></nav>

  <h1>Error Search</h1>
  <p>Paste your error message below. We'll match it against {{ total_errors }} known error patterns.</p>

  <div class="search-controls">
    <textarea id="search-input" rows="3" placeholder="Paste your error message here, e.g. ModuleNotFoundError: No module named 'torch'"></textarea>
    <div class="search-filters">
      <select id="domain-filter" aria-label="Filter by domain">
        <option value="">All domains ({{ domain_count }})</option>
        {% for domain in domain_errors %}
        <option value="{{ domain.name }}">{{ domain.name | display_name }} ({{ domain.errors|length }})</option>
        {% endfor %}
      </select>
      <span id="search-status" class="meta"></span>
      <span class="meta kbd-hint"><kbd>/</kbd> focus · <kbd>Esc</kbd> clear · <kbd>Enter</kbd> go</span>
    </div>
  </div>

  <div id="results"></div>
  <div id="no-results">
    <p>No matching errors found. Try pasting more of the error message, or <a href="https://github.com/dbwls99706/deadends.dev/issues/new">request this error</a>.</p>
  </div>

  <section id="recent-errors" style="display:none;">
    <h2>Recently Viewed</h2>
    <div id="recent-list"></div>
  </section>

  <section id="all-errors">
    <details>
      <summary><h2 style="display:inline;">All Known Errors ({{ total_errors }})</h2></summary>
    {% for domain in domain_errors %}
    <h3>{{ domain.name | display_name }} ({{ domain.errors|length }})</h3>
    {% for err in domain.errors %}
    <div class="error-entry">
      <a href="{{ err.page_url }}"><code>{{ err.signature }}</code></a>
      <span class="verdict-{{ err.resolvable }}">[{{ err.resolvable }}]</span>
      <span class="meta">{{ err.dead_end_count }} dead ends · {{ err.workaround_count }} workarounds</span>
    </div>
    {% endfor %}
    {% endfor %}
    </details>
  </section>

  <footer class="meta">
    <p><a href="{{ base_path }}/">deadends.dev</a> · <a href="{{ base_path }}/api/v1/index.json">API</a> · <a href="https://github.com/dbwls99706/deadends.dev">GitHub</a></p>
  </footer>

  <script>
    (function() {
      var errors = {{ search_data | safe_json_ld }};
      var input = document.getElementById('search-input');
      var resultsDiv = document.getElementById('results');
      var noResults = document.getElementById('no-results');
      var allErrors = document.getElementById('all-errors');
      var domainFilter = document.getElementById('domain-filter');
      var searchStatus = document.getElementById('search-status');
      var debounceTimer;

      // Pre-compile regexes
      var compiled = [];
      for (var i = 0; i < errors.length; i++) {
        try {
          compiled.push({
            data: errors[i],
            re: new RegExp(errors[i].regex, 'i')
          });
        } catch(e) {
          compiled.push({ data: errors[i], re: null });
        }
      }

      // Levenshtein distance for fuzzy matching
      function levenshtein(a, b) {
        if (a.length === 0) return b.length;
        if (b.length === 0) return a.length;
        // Limit length to avoid performance issues
        if (a.length > 200) a = a.substring(0, 200);
        if (b.length > 200) b = b.substring(0, 200);
        var matrix = [];
        for (var i = 0; i <= b.length; i++) matrix[i] = [i];
        for (var j = 0; j <= a.length; j++) matrix[0][j] = j;
        for (var i = 1; i <= b.length; i++) {
          for (var j = 1; j <= a.length; j++) {
            if (b.charAt(i - 1) === a.charAt(j - 1)) {
              matrix[i][j] = matrix[i - 1][j - 1];
            } else {
              matrix[i][j] = Math.min(
                matrix[i - 1][j - 1] + 1,
                matrix[i][j - 1] + 1,
                matrix[i - 1][j] + 1
              );
            }
          }
        }
        return matrix[b.length][a.length];
      }

      // Fuzzy word match: check if any word in query fuzzy-matches
      function fuzzyWordScore(queryWords, sigWords) {
        var score = 0;
        for (var qi = 0; qi < queryWords.length; qi++) {
          var qw = queryWords[qi];
          if (qw.length < 3) continue;
          for (var si = 0; si < sigWords.length; si++) {
            var sw = sigWords[si];
            if (sw.length < 3) continue;
            var maxLen = Math.max(qw.length, sw.length);
            var dist = levenshtein(qw, sw);
            // Allow 1 edit per 4 characters
            var threshold = Math.floor(maxLen / 4);
            if (dist <= threshold && dist > 0) {
              score += Math.max(1, 5 - dist);
            }
          }
        }
        return score;
      }

      // Highlight matching text
      function highlightText(text, query) {
        if (!query || query.length < 3) return escapeHtml(text);
        var escaped = escapeHtml(text);
        var lowerText = text.toLowerCase();
        var lowerQuery = query.toLowerCase();

        // Try to highlight exact substring first
        var idx = lowerText.indexOf(lowerQuery);
        if (idx !== -1) {
          var before = escapeHtml(text.substring(0, idx));
          var match = escapeHtml(text.substring(idx, idx + query.length));
          var after = escapeHtml(text.substring(idx + query.length));
          return before + '<mark>' + match + '</mark>' + after;
        }

        // Highlight matching words
        var words = query.toLowerCase().split(/\W+/).filter(function(w) {
          return w.length > 2;
        });
        if (words.length === 0) return escaped;
        var pattern = words.map(function(w) {
          return w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }).join('|');
        try {
          var re = new RegExp('(' + pattern + ')', 'gi');
          return escaped.replace(re, '<mark>$1</mark>');
        } catch(e) {
          return escaped;
        }
      }

      var stopwords = new Set(['the','a','an','is','are','was','were','be',
        'been','being','have','has','had','do','does','did','will','would',
        'could','should','may','might','shall','can','to','of','in','for',
        'on','with','at','by','from','no','not','error','when','or','and']);

      function search(query) {
        var domain = domainFilter.value;
        if ((!query || query.length < 3) && !domain) {
          resultsDiv.innerHTML = '';
          noResults.style.display = 'none';
          allErrors.style.display = 'block';
          searchStatus.textContent = '';
          return;
        }
        allErrors.style.display = 'none';
        var matches = [];
        var lowerQuery = query ? query.toLowerCase() : '';
        var queryWords = lowerQuery.split(/\W+/).filter(function(w) {
          return w.length > 2 && !stopwords.has(w);
        });

        for (var i = 0; i < compiled.length; i++) {
          var entry = compiled[i];

          // Domain filter
          if (domain && entry.data.domain !== domain) continue;

          var score = 0;

          if (query && query.length >= 3) {
            // Regex match (highest priority)
            if (entry.re && entry.re.test(query)) {
              score += 100;
            }
            // Signature substring match
            if (entry.data.signature.toLowerCase().indexOf(lowerQuery) !== -1) {
              score += 50;
            }
            // Query contains signature words
            var sigWords = entry.data.signature.toLowerCase().split(/\W+/).filter(function(w) {
              return w.length > 2 && !stopwords.has(w);
            });
            for (var w = 0; w < sigWords.length; w++) {
              if (lowerQuery.indexOf(sigWords[w]) !== -1) {
                score += 10;
              }
            }
            // Query words match signature words
            for (var qw = 0; qw < queryWords.length; qw++) {
              for (var sw = 0; sw < sigWords.length; sw++) {
                if (queryWords[qw] === sigWords[sw]) {
                  score += 5;
                }
              }
            }
            // Fuzzy matching for typos
            var fuzzy = fuzzyWordScore(queryWords, sigWords);
            if (fuzzy > 0 && score === 0) {
              score += fuzzy;
            }
            // Summary keyword match
            if (entry.data.summary) {
              var lowerSummary = entry.data.summary.toLowerCase();
              for (var qw2 = 0; qw2 < queryWords.length; qw2++) {
                if (lowerSummary.indexOf(queryWords[qw2]) !== -1) {
                  score += 3;
                }
              }
            }
          } else if (domain) {
            // Domain filter only, no query — show all in domain
            score = 1;
          }

          if (score > 0) {
            matches.push({ score: score, data: entry.data });
          }
        }

        matches.sort(function(a, b) {
          if (b.score !== a.score) return b.score - a.score;
          return b.data.fix_success_rate - a.data.fix_success_rate;
        });

        if (matches.length === 0) {
          resultsDiv.innerHTML = '';
          noResults.style.display = 'block';
          searchStatus.textContent = '';
          return;
        }
        noResults.style.display = 'none';
        var total = matches.length;
        var limit = Math.min(total, 30);
        searchStatus.textContent = total + ' match' + (total !== 1 ? 'es' : '') + (total > limit ? ' (showing top ' + limit + ')' : '');

        var html = '<h2>Matches (' + total + ')</h2>';
        for (var j = 0; j < limit; j++) {
          var d = matches[j].data;
          var verdictClass = 'verdict-' + d.resolvable;
          var sig = highlightText(d.signature, query);
          html += '<div class="result">'
            + '<h3><a href="' + d.page_url + '"><code>'
            + sig + '</code></a> '
            + '<span class="' + verdictClass + '">[' + d.resolvable + ']</span>'
            + ' <span class="result-domain">' + escapeHtml(d.domain) + '</span></h3>'
            + '<p class="result-summary">' + (d.summary ? highlightText(d.summary, query) : '') + '</p>'
            + '<p class="meta">'
            + '<span class="dead-end-count">' + d.dead_end_count + ' dead ends</span> · '
            + '<span class="workaround-count">' + d.workaround_count + ' workarounds</span> · '
            + 'Fix rate: ' + Math.round(d.fix_success_rate * 100) + '%';
          if (matches[j].score >= 100) {
            html += ' · <span class="match-quality match-exact">Regex match</span>';
          } else if (matches[j].score >= 50) {
            html += ' · <span class="match-quality match-high">High match</span>';
          } else if (matches[j].score >= 10) {
            html += ' · <span class="match-quality match-medium">Partial match</span>';
          } else {
            html += ' · <span class="match-quality match-fuzzy">Fuzzy match</span>';
          }
          html += '</p></div>';
        }
        resultsDiv.innerHTML = html;
      }

      function escapeHtml(s) {
        var d = document.createElement('div');
        d.appendChild(document.createTextNode(s));
        return d.innerHTML;
      }

      function updateUrlState(query, domain) {
        var url = new URL(window.location);
        if (query) {
          url.searchParams.set('q', query);
        } else {
          url.searchParams.delete('q');
        }
        if (domain) {
          url.searchParams.set('domain', domain);
        } else {
          url.searchParams.delete('domain');
        }
        history.replaceState(null, '', url);
      }

      function doSearch() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(function() {
          var q = input.value.trim();
          var d = domainFilter.value;
          search(q);
          updateUrlState(q, d);
        }, 150);
      }

      input.addEventListener('input', doSearch);
      domainFilter.addEventListener('change', doSearch);

      // Arrow key navigation for search results
      var activeResultIdx = -1;

      function highlightResult(idx) {
        var results = resultsDiv.querySelectorAll('.result');
        for (var i = 0; i < results.length; i++) {
          results[i].classList.remove('result-active');
        }
        if (idx >= 0 && idx < results.length) {
          results[idx].classList.add('result-active');
          results[idx].scrollIntoView({ block: 'nearest' });
        }
      }

      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        var results = resultsDiv.querySelectorAll('.result');

        // '/' to focus search (when not already in an input)
        if (e.key === '/' && document.activeElement !== input && document.activeElement.tagName !== 'SELECT') {
          e.preventDefault();
          input.focus();
        }
        // Escape to clear and blur
        if (e.key === 'Escape') {
          if (activeResultIdx >= 0) {
            activeResultIdx = -1;
            highlightResult(-1);
            input.focus();
          } else if (document.activeElement === input) {
            input.value = '';
            input.blur();
            search('');
            updateUrlState('', domainFilter.value);
          }
        }
        // Arrow down to navigate results
        if (e.key === 'ArrowDown' && results.length > 0) {
          e.preventDefault();
          activeResultIdx = Math.min(activeResultIdx + 1, results.length - 1);
          highlightResult(activeResultIdx);
        }
        // Arrow up
        if (e.key === 'ArrowUp' && results.length > 0) {
          e.preventDefault();
          activeResultIdx = Math.max(activeResultIdx - 1, -1);
          highlightResult(activeResultIdx);
          if (activeResultIdx === -1) input.focus();
        }
        // Enter to navigate to active or first result
        if (e.key === 'Enter') {
          var targetResult;
          if (activeResultIdx >= 0 && results[activeResultIdx]) {
            targetResult = results[activeResultIdx].querySelector('a');
          } else if (document.activeElement === input) {
            targetResult = resultsDiv.querySelector('.result a');
          }
          if (targetResult) {
            window.location.href = targetResult.href;
          }
        }
      });

      // Reset active index when search changes
      var origSearch = search;
      search = function(q) {
        activeResultIdx = -1;
        origSearch(q);
      };

      window.addEventListener('popstate', function() {
        var params = new URLSearchParams(window.location.search);
        var q = params.get('q') || '';
        var d = params.get('domain') || '';
        input.value = q;
        domainFilter.value = d;
        search(q);
      });

      // Support ?q= and ?domain= URL parameters for programmatic deep-linking
      // AI coding agents can link to /search/?q=ModuleNotFoundError&domain=python
      var params = new URLSearchParams(window.location.search);
      var q = params.get('q');
      var d = params.get('domain');
      if (d) domainFilter.value = d;
      if (q) {
        input.value = q;
        search(q);
      } else if (d) {
        search('');
      }
      // Recently viewed errors (localStorage)
      var recentSection = document.getElementById('recent-errors');
      var recentList = document.getElementById('recent-list');
      try {
        var recent = JSON.parse(localStorage.getItem('deadends_recent') || '[]');
        if (recent.length > 0 && !q) {
          var rHtml = '';
          for (var ri = 0; ri < Math.min(recent.length, 10); ri++) {
            var r = recent[ri];
            rHtml += '<div class="error-entry">'
              + '<a href="' + escapeHtml(r.url) + '"><code>' + escapeHtml(r.sig) + '</code></a>'
              + ' <span class="meta">' + escapeHtml(r.domain) + '</span>'
              + '</div>';
          }
          recentList.innerHTML = rHtml;
          recentSection.style.display = 'block';
        }
      } catch(e) {}
    })();
  </script>
</body>
</html>
